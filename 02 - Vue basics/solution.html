<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VueStarter</title>
</head>

<body>
    <div id="app">

        <select v-model="selectedUserId">
            <option value="">Select a user</option>
            <option v-for="user in users" v-bind:value="user.id">
                {{ user.name }}
            </option>
        </select>

        <hr>

        <p>Selected user id: {{ selectedUserId }}</p>

        <p>Selected user object: {{ selectedUser(selectedUserId) }}</p>

        <!-- remove comment to see all the fetched users -->
        <!-- <hr>
            {{ users }}
        -->
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        // Destructing createApp, ref and onMounted from Vue object
        const { createApp, ref, onMounted } = Vue

        const app = createApp({
            setup() {
                // users array to store the users fetched from the api
                const users = ref([])
                // function to download users from the server
                const fetchUsers = async () => {
                    const response = await fetch('https://jsonplaceholder.typicode.com/users')
                    const data = await response.json()

                    users.value = data
                }

                // selectedUserId to store the selected user id
                const selectedUserId = ref(null)

                // function to get the selected user info by the selected user id
                const selectedUser = (id) => {
                    // map the users to an array of objects keeping only the id, name and email properties
                    return users.value
                        .map(user => ({
                            id: user.id,
                            name: user.name,
                            email: user.email,
                        }))
                        // find the single user object with the selected user id
                        .find(user => user.id === id)
                }

                onMounted(() => {
                    // start downloading the users from the server when the app is mounted
                    fetchUsers()
                })

                // return everything needed during rendering
                return {
                    users,
                    selectedUserId,

                    selectedUser,
                }
            }
        }).mount('#app')
    </script>
</body>

</html>
